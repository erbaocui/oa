<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.thinkgem.jeesite.modules.contract.dao.ContractDao">
	<sql id="contractColumns">
       c.id
      ,c.code
      ,c.project_id as "project.id"
      ,p.name as "project.name"
      ,c.name
      ,c.create_time
      ,c.creator_id
      ,c.manager_id
      ,c.value
      ,c.income
      ,c.type
      ,c.status
      ,c.office_id as "office.id"
      ,o.name as "office.name"
      ,c.signed_time
      ,c.begin_time
      ,c.end_time
      ,c.contact
      ,c.contact_phone
      ,c.remark
      ,c.is_sub
      ,c.blueprint_num
      ,c.payment
      ,c.seal_time
      ,c.record_time
      ,c.return_time
      ,c.return_financial_time
      ,c.sub_item
      ,c.time_limit
      ,c.price
      ,c.area
      ,c.investment
      ,c.progress
    </sql>
    
    <sql id="contractJoins">
        LEFT JOIN bm_project p ON p.id = c.project_id
        LEFT JOIN sys_office o ON o.id = c.office_id
    </sql>


	
	<!-- 分页查询合同信息 -->
	<select id="findListByQueryObject" resultType="com.thinkgem.jeesite.modules.contract.entity.Contract">
		SELECT
			<include refid="contractColumns"/>
		FROM bm_contract c
		<include refid="contractJoins"/>
		<!--
		<if test="role != null and role.id != null and role.id != ''">
			JOIN sys_user_role ur ON ur.user_id = a.id AND ur.role_id = #{role.id}
		</if>
		-->
		WHERE 1=1

		<if test="office != null and office.id != null and office.id != ''">
			AND (o.id = #{office.id} OR o.parent_ids LIKE 
					<if test="dbName == 'oracle'">'%,'||#{office.id}||',%')</if>
					<if test="dbName == 'mssql'">'%,'+#{office.id}+',%')</if>
					<if test="dbName == 'mysql'">CONCAT('%,', #{office.id}, ',%'))</if>
		</if>
		<!-- 如果不是超级管理员，则不显示超级管理员用户 -->

		<!-- 数据范围过滤 -->
		<choose>
			<when test="page !=null and page.orderBy != null and page.orderBy != ''">
				ORDER BY ${page.orderBy}
			</when>
			<otherwise>
				ORDER BY c.code
			</otherwise>
		</choose>
	</select>
	

	
</mapper>